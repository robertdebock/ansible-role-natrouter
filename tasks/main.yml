---
# tasks file for natrouter
- name: install iptables
  package:
    name: iptables

- name: enable ip forwarding
  sysctl:
    name: net.ipv4.ip_forward
    value: 1
    state: present
    reload: True
  when:
    - ansible_virtualization_type != "docker"

- name: set routing rules
  iptables:
    table: nat
    chain: POSTROUTING
    out_interface: '{{ natrouter_public_interface }}'
    source: '{{ natrouter_private_network }}'
    destination: '{{ natrouter_destination }}'
    jump: MASQUERADE
    protocol: '{{ item }}'
    comment: Ansible NAT Masquerade
  with_items:
    - "{{ natrouter_protocols }}"
  when:
    - ansible_virtualization_type != "docker"
